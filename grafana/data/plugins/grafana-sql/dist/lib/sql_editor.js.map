{"version":3,"sources":["../../src/lib/sql_editor.js"],"names":["angular","CodeMirror","SqlFormater","SQLEditor","module","directive","restrict","require","compile","link","scope","iElement","iAttrs","ngModel","def","lineNumbers","mode","theme","width","styleActiveLine","matchBrackets","options","extend","value","text","$eval","sqlCodemirror","sqlCodemirrorOpts","editor","fromTextArea","on","instance","newValue","getValue","$viewValue","$evalAsync","$setViewValue","$formatters","push","isUndefined","isObject","isArray","Error","$render","sql","res","format","replace","setValue","err"],"mappings":";;;;;;;;;;;;;;;AAAOA,U;;AAECC,a,aAAAA,U;AAAWC,c,aAAAA,W;;;;;;;;;;;;;;;;;;;;;AAEEC,Y;AAEpB,yBAAc;AAAA;;AACb,SAAIC,SAASJ,QAAQI,MAAR,CAAe,oBAAf,CAAb;AACAA,YAAOC,SAAP,CAAiB,eAAjB,EAAkC,KAAKA,SAAvC;AAEA;;;;iCAEW;;AAEX,aAAO;AACFC,iBAAU,IADR;AAEFC,gBAAS,UAFP;AAGFC,gBAAS,SAASA,OAAT,GAAmB;AAC1B,eAAOC,IAAP;AACD;AALC,OAAP;;AAQG,eAASA,IAAT,CAAcC,KAAd,EAAqBC,QAArB,EAA+BC,MAA/B,EAAuCC,OAAvC,EAAgD;AACjD,WAAIC,MAAM;AACHC,qBAAa,IADV;AAEHC,cAAK,YAFF;AAGHC,eAAM,YAHH;AAIHC,eAAM,MAJH;AAKHC,yBAAiB,IALd;AAMTC,uBAAe;AANN,QAAV;AAQG,WAAIC,UAAUrB,QAAQsB,MAAR,CACb,EAACC,OAAMZ,SAASa,IAAT,EAAP,EADa,EAEXd,MAAMe,KAAN,CAAYb,OAAOc,aAAnB,CAFW,EAGXhB,MAAMe,KAAN,CAAYb,OAAOe,iBAAnB,KAAuCb,GAH5B,CAAd;;AAMA,WAAIc,SAAO3B,WAAW4B,YAAX,CAAwBlB,SAAS,CAAT,CAAxB,EAAqCU,OAArC,CAAX;AACAO,cAAOE,EAAP,CAAU,QAAV,EAAoB,UAASC,QAAT,EAAmB;AACpC,YAAIC,WAAWD,SAASE,QAAT,EAAf;AACA,YAAID,aAAanB,QAAQqB,UAAzB,EAAqC;AACnCxB,eAAMyB,UAAN,CAAiB,YAAW;AAC1BtB,kBAAQuB,aAAR,CAAsBJ,QAAtB;AACD,UAFD;AAGD;AACH,QAPD;;AASA,WAAI,CAACnB,OAAL,EAAc;AAAE;AAAS;;AAEzBA,eAAQwB,WAAR,CAAoBC,IAApB,CAAyB,UAASf,KAAT,EAAgB;AACtC,YAAIvB,QAAQuC,WAAR,CAAoBhB,KAApB,KAA8BA,UAAU,IAA5C,EAAkD;AAChD,gBAAO,EAAP;AACD,SAFD,MAEO,IAAIvB,QAAQwC,QAAR,CAAiBjB,KAAjB,KAA2BvB,QAAQyC,OAAR,CAAgBlB,KAAhB,CAA/B,EAAuD;AAC5D,eAAM,IAAImB,KAAJ,CAAU,4DAAV,CAAN;AACD;AACD,eAAOnB,KAAP;AACF,QAPD;;AASAV,eAAQ8B,OAAR,GAAkB,YAAW;AAC1B,YAAIC,MAAM/B,QAAQqB,UAAR,IAAsB,EAAhC;AACD,YAAIW,MAAI3C,YAAY4C,MAAZ,CAAmBF,IAAIG,OAAJ,CAAY,GAAZ,EAAgB,EAAhB,CAAnB,EAAwC,EAAxC,CAAR;AACA,YAAG,OAAOF,GAAP,KAAc,QAAjB,EAA2BD,MAAIC,GAAJ;AAC1BjB,eAAOoB,QAAP,CAAgBJ,GAAhB;AACF,QALD;AAMD;AACJ;;;4BAGQA,G,EAAI;AACV,UAAG;AACF,cAAO1C,YAAY4C,MAAZ,CAAmBF,IAAIG,OAAJ,CAAY,GAAZ,EAAgB,EAAhB,CAAnB,EAAwC,EAAxC,CAAP;AACA,OAFD,CAEC,OAAME,GAAN,EAAU;AACV,cAAOL,GAAP;AACA;AACD;;;;;;sBAtEiBzC,S","file":"sql_editor.js","sourcesContent":["import angular from 'angular';\r\nimport './editor.css!';\r\nimport {CodeMirror,SqlFormater} from './editor.js';\t\r\n\r\nexport default class SQLEditor {\r\n\t\r\n\tconstructor() {\r\n\t\tvar module = angular.module('grafana.directives');\r\n\t\tmodule.directive('sqlCodemirror', this.directive);\r\n\t\t\r\n\t}\r\n\r\n\tdirective() {\r\n\t\t\r\n\t\treturn {\r\n\t\t\t    restrict: 'EA',\r\n\t\t\t    require: '?ngModel',\r\n\t\t\t    compile: function compile() {\r\n\t\t\t      return link;\r\n\t\t\t    }\r\n\t    }\r\n\t\t\r\n\t    function link(scope, iElement, iAttrs, ngModel) {\r\n\t\t\t\tvar def = {\r\n\t\t\t        lineNumbers: true,\r\n\t\t\t        mode:'text/x-sql',\r\n\t\t\t        theme:'blackboard',\r\n\t\t\t        width:'100%',\r\n\t\t\t        styleActiveLine: true,\r\n\t\t\t\t\tmatchBrackets: true\r\n\t\t\t\t }\r\n\t\t\t    var options = angular.extend(\r\n\t\t\t    \t{value:iElement.text()},\r\n\t\t\t      \tscope.$eval(iAttrs.sqlCodemirror),\r\n\t\t\t      \tscope.$eval(iAttrs.sqlCodemirrorOpts)||def\r\n\t\t\t    );\r\n\t\t\t\r\n\t\t\t    var editor=CodeMirror.fromTextArea(iElement[0], options);\r\n\t\t\t    editor.on('change', function(instance) {\r\n\t\t\t\t      var newValue = instance.getValue();\r\n\t\t\t\t      if (newValue !== ngModel.$viewValue) {\r\n\t\t\t\t        scope.$evalAsync(function() {\r\n\t\t\t\t          ngModel.$setViewValue(newValue);\r\n\t\t\t\t        });\r\n\t\t\t\t      }\r\n\t\t\t    });\r\n\t\t\t\r\n\t\t\t    if (!ngModel) { return; }\r\n\t\t\t    \r\n\t\t\t    ngModel.$formatters.push(function(value) {\r\n\t\t\t\t      if (angular.isUndefined(value) || value === null) {\r\n\t\t\t\t        return '';\r\n\t\t\t\t      } else if (angular.isObject(value) || angular.isArray(value)) {\r\n\t\t\t\t        throw new Error('sql-codemirror cannot use an object or an array as a model');\r\n\t\t\t\t      }\r\n\t\t\t\t      return value;\r\n\t\t\t    });\r\n\t\t\r\n\t\t\t    ngModel.$render = function() {\r\n\t\t\t\t      var sql = ngModel.$viewValue || '';\r\n\t\t  \t\t\t  var res=SqlFormater.format(sql.replace(';',''), {});\r\n\t\t  \t\t\t  if(typeof res ===\"string\") sql=res;\r\n\t\t\t\t      editor.setValue(sql);\r\n\t\t\t    };\r\n    \t}\r\n\t}\r\n\t  \r\n  \r\n  \tformat(sql){\r\n  \t\ttry{\r\n  \t\t\treturn SqlFormater.format(sql.replace(';',''), {});\r\n  \t\t}catch(err){\r\n  \t\t\treturn sql;\r\n  \t\t}\r\n  \t}\r\n\r\n}"]}